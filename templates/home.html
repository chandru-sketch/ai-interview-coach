{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Interview Coach</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body style="width:100%; height:100%; margin:0; padding:0; overflow-x:hidden;">
    <!-- Home Section: Daily Mission, Feedback, FAQ -->
    <div id="home-section" style="display:none; max-width:900px; margin:24px auto 0 auto; background:#fff; border-radius:10px; box-shadow:0 4px 16px rgba(78,154,241,0.08); padding:32px;">
      <h2 style="margin-top:0;">Daily Mission</h2>
      <ul style="margin-bottom:24px;">
        <li>Complete 3 mock interviews</li>
        <li>Review your resume for improvements</li>
        <li>Practice 2 behavioral questions</li>
      </ul>
      <h2>Feedback</h2>
      <p>Share your experience or suggestions to help us improve!</p>
      <textarea style="width:100%; height:60px; margin-bottom:12px; border-radius:6px; border:1px solid #ccc; padding:8px;"></textarea>
      <button style="background:#4e9af1; color:#fff; border:none; border-radius:6px; padding:8px 18px; cursor:pointer;">Submit Feedback</button>
      <h2 style="margin-top:32px;">FAQ</h2>
      <details style="margin-bottom:12px;"><summary>How does the AI Interview Coach work?</summary><div style="margin-top:8px;">It uses advanced AI to simulate real interview scenarios and provide feedback.</div></details>
      <details style="margin-bottom:12px;"><summary>Can I upload my resume?</summary><div style="margin-top:8px;">Yes, upload your resume in PDF, DOC, or DOCX format for personalized feedback.</div></details>
      <details style="margin-bottom:12px;"><summary>Is my data private?</summary><div style="margin-top:8px;">Your data is secure and used only for improving your interview experience.</div></details>
    </div>
    <div class="header">
      <h1>AI Interview Coach</h1>
      <p>Your personal AI-powered interview preparation assistant</p>
    </div>
    <!-- Menu Bar with Icons -->
    <div style="width:100%; display:flex; justify-content:space-between; align-items:center; background:#fff; border-bottom:1px solid #eee; padding:8px 24px 8px 24px; box-sizing:border-box;">
      <button id="menuHamburger" style="background:none; border:none; display:flex; align-items:center; text-decoration:none; color:#222; font-size:1.2rem; cursor:pointer;">
        <span style="margin-right:8px;">
          <svg xmlns='http://www.w3.org/2000/svg' width='28' height='28' fill='none' stroke='currentColor' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'><line x1='4' y1='7' x2='24' y2='7'/><line x1='4' y1='14' x2='24' y2='14'/><line x1='4' y1='21' x2='24' y2='21'/></svg>
        </span>
      </button>
  <div id="menuDrawer" style="position:fixed; top:0; left:0; width:260px; background:#23272b; box-shadow:2px 0 8px rgba(0,0,0,0.18); border-right:2px solid #0099cc; height:100vh; z-index:1000; transform:translateX(-100%); transition:transform 0.3s; color:#fff;">
        <button id="closeBtn" style="background:none; border:none; font-size:1.5rem; float:right; margin:8px 12px 0 0; color:#fff; cursor:pointer;">&times;</button>
        <div style="padding:32px 24px 0 24px;">
          <div style="font-weight:700; font-size:1.3rem; letter-spacing:1px; margin-bottom:18px; color:#fff;">MENU</div>
          <a href="{% url 'daily_mission' %}" style="display:block; margin-bottom:18px; color:#00bfff; text-decoration:none; font-size:1.1rem; font-weight:500;">Daily Mission</a>
          <a href="{% url 'faq' %}" style="display:block; margin-bottom:18px; color:#00bfff; text-decoration:none; font-size:1.1rem; font-weight:500;">FAQ</a>
          <a href="{% url 'feedback' %}" style="display:block; margin-bottom:18px; color:#00bfff; text-decoration:none; font-size:1.1rem; font-weight:500;">Feedback</a>
        </div>
      </div>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          var menuOpen = false;
          var menuDrawer = document.getElementById('menuDrawer');
          var menuHamburger = document.getElementById('menuHamburger');
          var closeBtn = document.getElementById('closeBtn');
          menuHamburger.onclick = function(e) {
            e.stopPropagation();
            if (menuOpen) {
              menuOpen = false;
              menuDrawer.style.transform = 'translateX(-100%)';
            } else {
              menuOpen = true;
              menuDrawer.style.transform = 'translateX(0)';
            }
          };
          closeBtn.onclick = function(e) {
            menuOpen = false;
            menuDrawer.style.transform = 'translateX(-100%)';
          };
          window.addEventListener('click', function(e) {
            if (menuOpen && !menuDrawer.contains(e.target) && !menuHamburger.contains(e.target)) {
              menuOpen = false;
              menuDrawer.style.transform = 'translateX(-100%)';
            }
          });
        });
      </script>
      <div style="display:flex; align-items:center; gap:12px;">
        <a href="/profile" style="display:flex; align-items:center; text-decoration:none; color:#222; font-size:1.2rem;">
          <span style="margin-right:8px;">
            <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-user'><path d='M20 21v-2a4 4 0 0 0-3-3.87'/><path d='M4 21v-2a4 4 0 0 1 3-3.87'/><circle cx='12' cy='7' r='4'/></svg>
          </span>
          Profile
        </a>
        <a href="/logout/" id="logout-link" style="display:flex; align-items:center; text-decoration:none; color:#e74c3c; font-size:1.2rem; font-weight:500; padding:4px 12px; border-radius:6px; background:#fff0f0; border:1px solid #e74c3c; transition:background 0.18s;">
          <span style="margin-right:6px;">
            <svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4'/><polyline points='16 17 21 12 16 7'/><line x1='21' y1='12' x2='9' y2='12'/></svg>
          </span>
          Logout
        </a>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var logoutLink = document.getElementById("logout-link");
        if (logoutLink) {
          logoutLink.addEventListener("click", function (e) {
            if (!confirm("Are you sure you want to logout?")) {
              e.preventDefault();
            }
          });
        }
      });
    </script>
  <div class="container" style="max-width:1100px; min-height:calc(80vh - 60px); margin:32px auto 0 auto; box-sizing:border-box; display:flex; gap:80px;">
  <div class="sidebar" style="margin-left:-70px; width:340px;">
        <label for="field">Select Field:</label><br />
        <select id="field" name="field">
          <option value="Choose a field" selected>Choose a field</option>
          <option value="General">General</option>
          <option value="Software">Software</option>
          <option value="Data Science">Data Science</option>
          <option value="Marketing">Marketing</option>
          <option value="Finance">Finance</option>
          <option value="HR">HR</option>
          <option value="Design">Design</option>
          <option value="Teaching">Teaching</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Engineering">Engineering</option>
          <option value="Cybersecurity">Cybersecurity</option>
          <option value="Networking">Networking</option>
          <option value="Cloud Computing">Cloud Computing</option>
          <option value="AI & Machine Learning">AI & Machine Learning</option>
        </select>
        <br />
        <label for="difficulty">Difficulty:</label><br />
        <select id="difficulty" name="difficulty">
          <option value="">Any</option>
          <option value="Easy">Easy</option>
          <option value="Medium">Medium</option>
          <option value="Hard">Hard</option>
        </select>
        <br />
        <label for="tag">Tag:</label><br />
        <input
          type="text"
          id="tag"
          name="tag"
          placeholder="e.g. OOP, SQL, teamwork"
          style="width: 100%; margin-bottom: 12px"
        />
        <form enctype="multipart/form-data">
          <label for="resume">Upload Resume:</label><br />
          <input
            type="file"
            id="resume"
            name="resume"
            accept=".pdf,.doc,.docx"
          /><br />
          <small
            >Tip: Upload your latest resume in PDF, DOC, or DOCX format for best
            results.</small
          >
        </form>
      </div>
  <div class="main-content" style="width:600px;">
        <div
          id="chat-box"
          style="
            height: 340px;
            overflow-y: auto;
            background: #f8fbff;
            border-radius: 8px;
            padding: 18px 16px 8px 16px;
            margin-bottom: 10px;
            box-shadow: 0 1px 4px rgba(78, 154, 241, 0.04);
          "
        >
        <div id="mock-timer" style="font-weight: bold; color: red; margin: 10px 0;"></div>
          <!-- Initial coach message will be rendered by app.js for consistent bubble style -->
        </div>
        <div
          id="suggestion-box"
          class="suggestion"
          style="margin-bottom: 2px; display: block"
        >
          <b>Suggestion:</b> Please answer the question above.
        </div>
        <div class="input-row chat-input-card" style="flex-direction:column; align-items:stretch; gap:10px;">
          <textarea
            id="user-input"
            placeholder="Type your answer..."
            rows="3"
            class="chat-input-textarea"
            style="margin-bottom:12px;"
          ></textarea>
          <div style="display:flex; justify-content:space-between; gap:10px;">
            <button id="start-mock-btn" class="chat-btn chat-btn-blue">Start Mock Interview</button>
            <div style="display:flex; gap:10px;">
              <button id="send-btn" class="chat-btn chat-btn-green"><span class="ripple"></span>Send</button>
              <button onclick="clearChatHistory()" class="chat-btn chat-btn-red"><span class="ripple"></span>Clear Chat</button>
            </div>
<script>
// Button ripple animation
document.querySelectorAll('.chat-btn').forEach(btn => {
  btn.addEventListener('click', function(e) {
    let ripple = btn.querySelector('.ripple');
    if (!ripple) {
      ripple = document.createElement('span');
      ripple.className = 'ripple';
      btn.prepend(ripple);
    }
    ripple.classList.remove('show');
    const rect = btn.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    ripple.style.width = ripple.style.height = size + 'px';
    ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
    ripple.style.top = (e.clientY - rect.top - size/2) + 'px';
    ripple.classList.add('show');
    setTimeout(() => ripple.classList.remove('show'), 500);
  });
});
</script>
          </div>
        </div>
        <p id="voice-status" style="font-size: 14px; color: gray; margin-top: 6px;"></p>
        <div
          id="mock-timer"
          style="margin-top: 10px; font-weight: 600; color: #e67e22"
        ></div>
      </div>
      <script src="/static/app.js"></script>
      <script>
        function saveChatHistory() {
        let history = [];
        document.querySelectorAll('#chat-box .chat-message').forEach(msg => {
          history.push({
          role: msg.classList.contains('user') ? 'user' : 'coach',
          text: msg.textContent
        });
      });
    localStorage.setItem('chatHistory', JSON.stringify(history));
    }

    function loadChatHistory() {
        let history = JSON.parse(localStorage.getItem('chatHistory')) || [];
        chatLog.innerHTML = "";
        history.forEach(item => {
          addMessage(item.role, item.text.replace(/^You:|Coach:/, '').trim());
        });
    }

  function clearChatHistory() {
      // 1. Clear chat log on frontend
      const chatLog = document.getElementById('chat-box');
      chatLog.innerHTML = '';

      // 2. Remove chat history from localStorage
      localStorage.removeItem('chatHistory');

      // 3. Reset backend session
      fetch('/api/chat/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: 'RESET_SESSION' })
      })
      .then(res => res.json())
      .then(() => {
          // 4. Notify user that session is reset
          addMessage('coach', 'Session reset. You can start a new conversation now.');
      })
      .catch(() => {
          addMessage('coach', 'Error resetting chat session.');
      });
  }
      </script>
      <script src="/static/text-to-speech.js"></script>
      <script>
        function appendMessage(sender, text) {
          const chatBox = document.getElementById("chat-box");
          const msgDiv = document.createElement("div");
          msgDiv.className = "chat-message " + sender;
          msgDiv.innerHTML = `<b>${
            sender === "coach" ? "Coach" : "You"
          }:</b> ${text}`;
          chatBox.appendChild(msgDiv);
          chatBox.scrollTop = chatBox.scrollHeight;
          if (sender === "coach") {
            speakText(text);
          }
        }
        document.getElementById("send-btn").onclick = function () {
          const input = document.getElementById("user-input");
          const text = input.value.trim();
          if (!text) return;
          appendMessage("user", text);
          input.value = "";
          fetch("/chat/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": document.querySelector(
                "[name=csrfmiddlewaretoken]"
              ).value,
            },
            body: JSON.stringify({ message: text }),
          })
            .then((res) => res.json())
            .then((data) => {
              appendMessage("coach", data.reply);
            });
        };
      </script>
    </div>
    
    <!-- Process Dashboard Card -->
    <div id="process-dashboard" style="max-width:600px; margin:48px auto 24px auto; background:#fff; border-radius:12px; box-shadow:0 4px 16px rgba(78,154,241,0.10); padding:32px 28px; display:flex; flex-direction:column; align-items:center;">
      <h2 style="margin-bottom:18px; font-size:1.4rem; font-weight:700; color:#23272b;">Progress Dashboard</h2>
      <div style="width:100%; display:flex; justify-content:space-between; gap:18px;">
        <div style="flex:1; text-align:center;">
          <div style="font-size:1.1rem; color:#4e9af1; font-weight:600;">Answered</div>
          <div id="answered-count" style="font-size:1.5rem; font-weight:700; margin-top:6px;">0</div>
        </div>
        <div style="flex:1; text-align:center;">
          <div style="font-size:1.1rem; color:#43c463; font-weight:600;">Correct</div>
          <div id="correct-count" style="font-size:1.5rem; font-weight:700; margin-top:6px;">0</div>
        </div>
        <div style="flex:1; text-align:center;">
          <div style="font-size:1.1rem; color:#f39c12; font-weight:600;">Score</div>
          <div id="score-count" style="font-size:1.5rem; font-weight:700; margin-top:6px;">0 / 10</div>
        </div>
      </div>
    </div>
    <script>
      // Example: Update dashboard values (simulate live updates)
      // Replace with your offline AI model logic
      let answered = 0, correct = 0, score = 0;
      function updateDashboard(ans, cor, scr) {
        document.getElementById('answered-count').textContent = ans;
        document.getElementById('correct-count').textContent = cor;
        document.getElementById('score-count').textContent = scr + ' / 10';
      }
      // Example usage: updateDashboard(5, 3, 2, 7);
      // Call updateDashboard() whenever your AI model returns new values
    </script>
<!-- Video Tutorial Section -->
<div id="video-tutorial" style="max-width:900px; margin:48px auto; background:#fff; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.08); padding:32px; text-align:center;">
  <h2 style="font-size:1.5rem; font-weight:700; margin-bottom:18px; color:#23272b;">
    Interview Preparation Video
  </h2>
  <p style="margin-bottom:18px; color:#555;">
    Watch this short guide to learn how to perform well in interviews.
  </p>

  <!-- Video Tutorial Section -->
<div id="video-tutorial" style="max-width:900px; margin:48px auto; background:#fff; border-radius:12px; box-shadow:0 4px 16px rgba(78,154,241,0.08); padding:32px;">
  <h2 style="text-align:center; margin-bottom:24px; color:#23272b;">Watch How It Works</h2>
  <video controls style="width:100%; border-radius:12px;">
    <source src="{% static 'videos/interview_tips.mp4' %}" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <p style="margin-top:16px; color:#555;">
    How to Attend an Interview Successfully | AI Interview Coach
  </p>
</div>
<script>
document.getElementById('start-mock-btn').addEventListener('click', () => {
    const difficulty = document.getElementById('difficulty').value;
    const field = document.getElementById('field').value;
    const tag = document.getElementById('tag').value.trim();

    fetch('/start-interview/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({ field, difficulty, tag })
    })
    .then(res => res.json())
    .then(data => {
        // Display first AI question in chat-box
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML = `<div class="chat-message coach"><b>Coach:</b> ${data.coach_response}</div>`;
    });
});
</script>
  </body>
</html>
